<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mensajer√≠a Web</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="page-mensajeria">
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo">CW</div>
        <div>
          <h1 class="title">Panel de Mensajer√≠a</h1>
          <p class="subtitle">Gestiona contactos y env√≠a mensajes.</p>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-outline" onclick="cargarContactos()">üìÇ Cargar Contactos</button>
      </div>
      <div id="lista-contactos" class="list"></div>

      <hr class="sep">
      <h2 class="subtitle">Agregar Contacto</h2>
      <div class="form">
        <div class="form-row">
          <label>Nombre</label>
          <input id="nombreAgregar" class="input" type="text" />
        </div>
        <div class="form-row">
          <label>N√∫mero</label>
          <input id="numeroAgregar" class="input" type="text" placeholder="+5491122334455"/>
        </div>
        <button class="btn btn-primary" onclick="agregarContacto()">Agregar</button>
      </div>

      <hr class="sep">
      <h2 class="subtitle">Modificar Contacto</h2>
      <div class="form">
        <div class="form-row"><label>Nombre actual</label><input id="nombreMod" class="input"></div>
        <div class="form-row"><label>Nuevo nombre</label><input id="nuevoNombreMod" class="input"></div>
        <div class="form-row"><label>Nuevo n√∫mero</label><input id="nuevoNumeroMod" class="input"></div>
        <button class="btn" onclick="modificarContacto()">Modificar</button>
      </div>

      <hr class="sep">
      <h2 class="subtitle">Eliminar Contacto</h2>
      <div class="form">
        <div class="form-row"><label>Nombre</label><input id="nombreEliminar" class="input"></div>
        <button class="btn btn-danger" onclick="eliminarContacto()">Eliminar</button>
      </div>

      <hr class="sep">
      <h2 class="subtitle">Enviar Mensaje</h2>
      <div class="form">
        <div class="form-row"><label>Nombre destinatario</label><input id="nombreMensaje" class="input"></div>
        <div class="form-row"><label>Mensaje</label><textarea id="textoMensaje" rows="3" class="input"></textarea></div>
        <button class="btn btn-primary" onclick="enviarMensaje()">Enviar</button>
      </div>

      <div class="actions" style="margin-top:16px;">
        <button class="btn btn-outline" onclick="window.location.href='/'">‚¨Ö Volver</button>
      </div>

      <p id="status" class="small"></p>
    </div>
  </div>

<script>
// same JS logic from original, unchanged
async function cargarContactos() {
  const res = await fetch('/contactos');
  const contactos = await res.json();
  const lista = document.getElementById('lista-contactos');
  lista.innerHTML = '';
  for (const [nombre, numero] of Object.entries(contactos)) {
    const li = document.createElement('li');
    li.classList.add('badge');
    li.textContent = `${nombre}: ${numero}`;
    lista.appendChild(li);
  }
  setStatus("Contactos cargados.");
}
async function agregarContacto() {
  const nombre = document.getElementById('nombreAgregar').value.trim();
  const numero = document.getElementById('numeroAgregar').value.trim();
  if (!nombre || !numero) { setStatus("Completa nombre y n√∫mero.", true); return; }
  const res = await fetch('/contactos', {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nombre, numero })
  });
  const data = await res.json();
  if (data.status === "ok") { setStatus("Contacto agregado."); cargarContactos(); }
  else setStatus("Error agregando contacto.", true);
}
async function modificarContacto() {
  const nombre_actual = document.getElementById('nombreMod').value.trim();
  const nuevo_nombre = document.getElementById('nuevoNombreMod').value.trim();
  const nuevo_numero = document.getElementById('nuevoNumeroMod').value.trim();
  if (!nombre_actual || !nuevo_nombre || !nuevo_numero) { setStatus("Completa todos los campos.", true); return; }
  const res = await fetch('/contactos', {
    method: 'PUT', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nombre_actual, nuevo_nombre, nuevo_numero })
  });
  const data = await res.json();
  if (data.status === "ok") { setStatus("Contacto modificado."); cargarContactos(); }
  else setStatus("Error modificando contacto.", true);
}
async function eliminarContacto() {
  const nombre = document.getElementById('nombreEliminar').value.trim();
  if (!nombre) { setStatus("Completa el nombre.", true); return; }
  const res = await fetch('/contactos', {
    method: 'DELETE', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nombre })
  });
  const data = await res.json();
  if (data.status === "ok") { setStatus("Contacto eliminado."); cargarContactos(); }
  else setStatus("Contacto no encontrado.", true);
}
async function enviarMensaje() {
  const nombre = document.getElementById('nombreMensaje').value.trim();
  const mensaje = document.getElementById('textoMensaje').value.trim();
  if (!nombre || !mensaje) { setStatus("Completa destinatario y mensaje.", true); return; }
  const res = await fetch('/enviar', {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nombre, mensaje })
  });
  const data = await res.json();
  if (data.status) { setStatus("Mensaje en proceso de env√≠o."); }
  else setStatus("Error enviando mensaje.", true);
}
function setStatus(msg, error=false) {
  const statusDiv = document.getElementById('status');
  statusDiv.textContent = msg;
  statusDiv.className = error ? 'small' : 'small';
}
</script>
</body>
</html>
